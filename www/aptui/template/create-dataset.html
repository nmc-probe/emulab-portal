<div class='row'>
  <div class='col-lg-8 col-lg-offset-2
              col-md-8 col-md-offset-2
              col-sm-10 col-sm-offset-1
              col-xs-12'>
    <div class='panel panel-default'>
      <% if (!embedded) { %>
        <div class='panel-heading'>
          <h3 class='panel-title'><%= title %></h3>
	</div>
      <% } %>
      <div class='panel-body'>
	<form id='create_dataset_form'
              class='form-horizontal' role='form'
              method='post' action=create_dataset.php'>
	  <div class='row'>
	    <div class='col-sm-12'>
	      <% if (1 || projects) { %>
	        <% if (editing || projects.length == 1) { %>
	          <input name="dataset_pid" readonly
			 id="dataset_pid"
			 value="<%- formfields.dataset_pid %>"
			 class="form-control format-me"
			 data-label="Project"
			 data-key="dataset_pid">
		<% } else { %>
		  <select name="dataset_pid"
			  id="dataset_pid"
			  class='form-control format-me'
			  data-key="dataset_pid"
			  data-label="Project"
			  placeholder='Please Select'>
		    <% _.each(projects, function(name) { %>
	              <option 
			 <% if (_.has(formfields, 'dataset_pid') &&
			         formfields.dataset_pid == name) { %>
			     selected
			 <% } %>
			 value='<%= name %>'><%= name %>
		      </option>
		    <% }); %>
		  </select>
		<% } %>
	      <% } %>
	      <input name="dataset_name"
		     value="<%- formfields.dataset_name %>"
		     class="form-control format-me"
		     data-key="dataset_name"
		     data-label="Name"
		     <% if (editing) { %> readonly <% } %>
		     placeholder="alphanumeric, no spaces" type="text">
	      <% if (editing) { %>
	      <input name="dataset_type" type='hidden'
		     value="<%- formfields.dataset_type %>">
	      <input name='ignored'
		     value=<% if (formfields.dataset_type == "stdataset")
			      { %>'Short Term'<% }
		              else if (formfields.dataset_type == "ltdataset")
		              { %>'Long Term'<% } else { %>Image Backed'<% } %>
		     class="form-control format-me"
		     data-key="dataset_type"
		     data-label="Type"
		     readonly
		     type="text">
	      <% } else { %>
	      <div class='format-me' data-key='dataset_type'
		   data-label="Type">
                  <label class='radio'>
                    <input type='radio' name='dataset_type'
			   id='dataset_type_stdataset'
		             <% if (formfields.dataset_type == "stdataset") {
				%>checked<% } %>
			     value='stdataset'>Short term
    	          </label>
                  <label class='radio'>
                    <input type='radio' name='dataset_type'
			   id='dataset_type_ltdataset'
		             <% if (formfields.dataset_type == "ltdataset") {
				%>checked<% } %>
			     value='ltdataset'>Long term
    	          </label>
                  <label class='radio'>
                    <input type='radio' name='dataset_type'
			   id='dataset_type_imagedataset'
		             <% if (formfields.dataset_type == "imdataset") {
				%>checked<% } %>
			     value='imdataset'>Image backed
    	          </label>
		  <a href='#' id='dataset_help_link'>
		    <span>What type should I pick?</span></a>
	      </div>
	      <% } %>
	      <div id='dataset_size_div'
		   <% if (formfields.dataset_type == "imdataset") {
		      %> class='hidden' <% } %> >
		<input name="dataset_size"
		       value="<%- formfields.dataset_size %>"
		       class="form-control format-me"
		       data-key="dataset_size"
		       data-label="Size"
		       placeholder="eg: NNN(MB|GB|TB)"
		       <% if (editing) { %> readonly <% } %>
		       type="text">
	      </div>
	      <% if (! editing) { %>
	      <div id='dataset_imageonly_div'
		   <% if (formfields.dataset_type != "imdataset") {
		      %> class='hidden' <% } %> >
		<% if (instancelist) { %>
		  <select name="dataset_instance"
			  id="dataset_instance"
			  class='form-control format-me'
			  data-key="dataset_instance"
			  data-label="Instance"
			  placeholder='Please Select'>
		    <option value=''>Please Select</option>
		    <% _.each(instancelist, function(instance) { %>
		    <option
		       <% if (instance.uuid == formfields.dataset_instance) { %>
	               selected
		       <% } %>
		       value='<%= instance.uuid %>'><%= instance.name %>
		    </option>
		    <% }); %>
		  </select>
		  <select name="dataset_node"
			  id="dataset_node"
			  class='form-control format-me'
			  data-key="dataset_node"
			  data-label="Node"
			  placeholder='Please Select'>
		  </select>
		  <select name="dataset_bsname"
			  id="dataset_bsname"
			  class='form-control format-me'
			  data-key="dataset_bsname"
			  data-label="BS Name"
			  placeholder='Please Select'>
		  </select>
	        <% } else if (embedded) { %>
		  <input name="dataset_node" id='dataset_node'
			 value="<%- formfields.dataset_node %>"
			 class="form-control format-me"
			 data-key="dataset_node"
			 data-label="Node"
			 placeholder="Node to snapshot dataset from"
			 type="text">
		  <input name="dataset_bsname" id='dataset_bsname'
			 value="<%- formfields.dataset_bsname %>"
			 class="form-control format-me"
			 data-key="dataset_bsname"
			 data-label="BS Name"
			 placeholder="Blockstore name on the node"
			 type="text">
		<% } %>
	      </div>
	      <% } %>
	      <div id='dataset_expires_div'
		   <% if (formfields.dataset_type == "ltdataset" ||
		          formfields.dataset_type == "imdataset") {
		      %> class='hidden' <% } %> >
		<input name="dataset_expires"
		       style='position: relative; z-index:1000;'
		       id='dataset_expires'
		       <% if (editing) { %> readonly <% } %>
		       value="<%- formfields.dataset_expires %>"
		       class="form-control format-me"
		       data-key="dataset_expires"
		       data-label="Expires"
		       placeholder="MM/DD/YYYY"
		       type="text">
	      </div>
	      <div id='dataset_fstype_div'
		   <% if (formfields.dataset_type == "imdataset") {
		      %> class='hidden' <% } %> >
		<% if (editing) { %>
		<input name="dataset_fstype"
		       value="<%- formfields.dataset_fstype %>"
		       class="form-control format-me"
		       data-key="dataset_fstype"
		       data-label="FS Type"
		       readonly
		       type="text">
		<% } else { %>
		<select name="dataset_fstype"
			class="form-control format-me"
			data-key="dataset_fstype"
			data-label="FS Type">
		  <% _.each(fstypes, function(name) { %>
	            <option 
		       <% if (_.has(formfields, 'dataset_fstype') &&
		  	formfields.dataset_fstype == name) { %>
		       selected
		     <% } %>
		     value='<%= name %>'><%= name %>
		    </option>
		  <% }); %>
		</select>
		<% } %>
	      </div>
	      <!-- Permission checkboxes. -->
	      <div class='row'>
		<div class='col-sm-9 col-sm-offset-3'>
		  Who can read your dataset?
		</div>
	      </div>
	      <div class='row'>
		<div class='col-sm-8 col-sm-offset-4'>
		  <div class='format-me' data-key='dataset_read'>
		    <div class='radio'>
                      <label>
			<input type='radio' name='dataset_read'
			       id='dataset_read_public'
		               <% if (formfields.dataset_read == "global") {
				  %>checked<% } %>
			       value='global'>
			<em>Anyone</em>
    	              </label>
                    </div>
                    <div class='radio'>
                      <label>
			<input type='radio' name='dataset_read'
			       id='dataset_read_private'
		               <% if (formfields.dataset_read == "project") {
				  %>checked<% } %>
			       value='project'>
			Only members of 
			<span name="project_name">your project</span>
    	              </label>
                    </div>
                  </div>
		</div>
              </div>
	      <div class='row'>
		<div class='col-sm-9 col-sm-offset-3'>
		  Who can write to your dataset?
		</div>
	      </div>
	      <div class='row'>
		<div class='col-sm-8 col-sm-offset-4'>
		  <div class='format-me' data-key='dataset_modify'>
                    <div class='radio'>
                      <label>
			<input type='radio' name='dataset_modify'
			       id='dataset_modify_registered'
		               <% if (formfields.dataset_modify == "creator") {
				  %>checked<% } %>
			       value='creator'>
			Only you
    	              </label>
                    </div>
                    <div class='radio'>
                      <label>
			<input type='radio' name='dataset_modify'
			       id='dataset_modify_private'
		               <% if (formfields.dataset_modify == "project") {
				  %>checked<% } %>
			       value='project'>
			You and members of
			<span name="project_name">your project</span>
    	              </label>
                    </div>
                  </div>
		</div>
              </div>
	      
	      <% if (editing) { %>
	      <input type='hidden' name='dataset_uuid'
		     value='<%= formfields.dataset_uuid %>'>
	      <% } %>
	      
              <button class='btn btn-primary btn-sm pull-right'
                      id='dataset_submit_button'
                      type='submit' name='create'>
		<% if (editing) { %>Save Changes<% } else { %>Create<% } %>
	      </button>
	    </div>
	  </div>
	</form>
      </div>
    </div>
    <!-- place to hang the modals for now -->
    <!-- This is the Please Wait modal -->
    <div id='waitwait-modal' class='modal fade'>
      <div class='modal-dialog'>
	<div class='modal-content'>
	  <div class='modal-header'>
            <center><h3>Please Wait</h3></center>
	  </div>
	  <div class='modal-body'>
            <center><img src='images/spinner.gif' /></center>
	  </div>
	</div>
      </div>
    </div>
  </div>
</div>
